---
const categories = [
  { label: "Lighting", slug: "lighting" },
  { label: "Switch & Socket", slug: "switch-socket" },
  { label: "Wiring Accessories", slug: "wiring-accessories" },
  { label: "GI Conduit & Accessories", slug: "gi-conduit-accessories" },
  { label: "Connectors", slug: "connectors" },
  { label: "Cable Management System", slug: "cable-management" },
  { label: "Tools", slug: "tools" },
];

const activeCategory = Astro.params.category ?? "lighting";
const activeLabel =
  categories.find((c) => c.slug === activeCategory)?.label ?? "Select Category";
---
<div class="container mx-auto pt-24 sm:pt-40 px-5" data-pagefind-ignore>

  <!-- Heading -->
  <h1 class="text-3xl sm:text-4xl md:text-5xl font-medium mb-6 sm:mb-10">
    Browse by Product Category
  </h1>

  <!-- ================= MOBILE CUSTOM DROPDOWN ================= -->
  <div class="md:hidden relative mb-6" data-dropdown>
    <!-- Trigger -->
    <button
      type="button"
      data-dropdown-trigger
      class="
        w-full flex items-center justify-between
        rounded-xl border border-gray-300
        bg-white px-4 py-3
        text-base font-medium
        focus:outline-none
      "
    >
      <span>{activeLabel}</span>

      <!-- Chevron -->
      <svg
        class="h-5 w-5 transition-transform duration-200"
        data-chevron
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
          clip-rule="evenodd"
        />
      </svg>
    </button>

    <!-- Dropdown Menu -->
    <div
      data-dropdown-menu
      class="
        absolute z-40 mt-2 w-full
        rounded-xl border border-gray-200
        bg-white shadow-lg
        opacity-0 scale-95 pointer-events-none
        transition-all duration-200 origin-top
      "
    >
      <ul class="py-2 max-h-72 overflow-auto">
        {categories.map((cat) => (
          <li>
            <a
              href={`/products/${cat.slug}`}
              class:list={[
                "block px-4 py-3 text-sm transition",
                activeCategory === cat.slug
                  ? "bg-[#ef1923] text-white"
                  : "hover:bg-gray-100"
              ]}
            >
              {cat.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>

  <!-- ================= DESKTOP PILLS ================= -->
  <div class="hidden md:flex gap-3 pb-3">
    {categories.map((cat) => {
      const isActive = activeCategory === cat.slug;

      return (
        <a
          href={`/products/${cat.slug}`}
          class:list={[
            "whitespace-nowrap px-5 py-3 rounded-xl text-sm font-medium border transition-all duration-200",

            isActive &&
              "bg-[#ef1923] text-white border-[#ef1923] shadow-sm",

            !isActive &&
              "bg-[#f3f3f3] text-black border-transparent hover:bg-white hover:border-black",
          ]}
        >
          {cat.label}
        </a>
      );
    })}
  </div>

</div>

<!-- ================= DROPDOWN JS ================= -->
<script>
  (() => {
    const dropdown = document.querySelector("[data-dropdown]");
    if (!dropdown) return;

    const trigger = dropdown.querySelector("[data-dropdown-trigger]");
    const menu = dropdown.querySelector("[data-dropdown-menu]");
    const chevron = dropdown.querySelector("[data-chevron]");

    const open = () => {
      menu.classList.remove("opacity-0", "scale-95", "pointer-events-none");
      chevron.classList.add("rotate-180");
    };

    const close = () => {
      menu.classList.add("opacity-0", "scale-95", "pointer-events-none");
      chevron.classList.remove("rotate-180");
    };

    trigger.addEventListener("click", (e) => {
      e.stopPropagation();
      menu.classList.contains("pointer-events-none") ? open() : close();
    });

    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target)) close();
    });
  })();
</script>
