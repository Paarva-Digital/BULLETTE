
<header
  id="header"
  data-pagefind-ignore
  class="fixed top-0 left-0 w-full z-50 transition-all duration-300 font-quicksand invisible"
>
  <div
    class="sm:container mx-auto flex items-center justify-between
           px-4 sm:px-6 py-3 md:py-4
           bg-white sm:rounded-full sm:mt-3
           border border-gray-200"
  >

    <!-- Logo -->
    <div class="flex items-center">
      <img
        src="/icons/LOGO-09.png"
        alt="Bullette Logo"
        class="w-36 lg:w-52 object-contain pointer-events-none"
        loading="eager"
      />
    </div>

    <!-- Desktop Nav -->
    <nav
      class="hidden xl:flex items-center gap-10
             text-gray-800 font-medium tracking-wide"
    >
      <a href="/" class="hover:text-red-600 transition">HOME</a>

      <!-- PRODUCTS MEGA MENU -->
      <div class="relative group">
        <a href="/products/lighting"
           class="hover:text-red-600 transition flex items-center gap-1">
          PRODUCTS
          <svg class="w-4 h-4 transition-transform group-hover:rotate-180"
               fill="none" stroke="currentColor" stroke-width="2"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>

        <div
          class="absolute left-1/2 top-full mt-5 w-[760px]
                 -translate-x-1/2
                 opacity-0 invisible
                 group-hover:opacity-100 group-hover:visible
                 transition-all duration-300 z-50"
        >
          <div class="bg-white rounded-2xl border border-gray-100 shadow-xl p-6">
            <div class="grid grid-cols-3 gap-4">

              <a href="/products/lighting" class="product-card">
                <img src="/icons/Categ_icons/lighting.png" class="icon" />
                <span>Lighting</span>
              </a>

              <a href="/products/switch-socket" class="product-card">
                <img src="/icons/Categ_icons/light-switch.png" class="icon" />
                <span>Switch & Socket</span>
              </a>

              <a href="/products/wiring-accessories" class="product-card">
                <img src="/icons/Categ_icons/wiring.png" class="icon" />
                <span>Wiring Accessories</span>
              </a>

              <a href="/products/gi-conduit-accessories" class="product-card">
                <img src="/icons/Categ_icons/ethernet_2303616.png" class="icon" />
                <span>GI Conduit & Accessories</span>
              </a>

              <a href="/products/connectors" class="product-card">
                <img src="/icons/Categ_icons/terminal-block.png" class="icon" />
                <span>Connectors</span>
              </a>

              <a href="/products/cable-management" class="product-card">
                <img src="/icons/Categ_icons/CableManagement.png" class="icon" />
                <span>Cable Management</span>
              </a>

              <a href="/products/tools" class="product-card">
                <img src="/icons/Categ_icons/tool-box.png" class="icon" />
                <span>Tools</span>
              </a>

            </div>
          </div>
        </div>
      </div>

      <a href="/About" class="hover:text-red-600 transition">ABOUT US</a>
      <a href="/blog" class="hover:text-red-600 transition">BLOG</a>
    </nav>

<!-- SEARCH (Desktop) -->
<!-- SEARCH (Desktop – Headless) -->
<div class="hidden xl:block relative">
  <input
    id="productSearch"
    type="search"
    placeholder="Search products…"
    class="w-64 rounded-full border border-gray-300 px-4 py-2 text-sm
           focus:outline-none focus:ring-2 focus:ring-red-500"
  />

  <div
    id="productResults"
    class="absolute right-0 top-full mt-3 w-[26rem]
         hidden rounded-2xl bg-white
         border border-gray-100 shadow-2xl
         overflow-hidden
         z-[9999]"
  ></div>
</div>


<!-- CTA + Menu -->
<div class="flex items-center gap-2">

      <button id="theme-toggle"
              class="bg-black hidden transition lg:inline-flex items-center rounded-full w-fit h-15">
        <img src="/icons/ULTRA-23.png" alt="Ultra" class="w-38" />
      </button>

      <a href="/brochure.pdf" download
         class="group hidden lg:flex items-center gap-3
                px-4 py-3 lg:px-7 lg:py-4
                rounded-full bg-red-500
                transition hover:shadow-md hover:scale-[1.02]">
        <svg xmlns="http://www.w3.org/2000/svg"
             class="w-6 h-6 text-yellow-300"
             fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 16l4-5h-3V4h-2v7H8l4 5zm8 2v2H4v-2h16z"/>
        </svg>
        <span class="text-yellow-300 uppercase font-medium">
          Download Brochure
        </span>
      </a>

      <button id="menuIcon"
              class="xl:hidden rounded-full p-2 bg-gray-100">
        <img src="/icons/hamburger.svg" class="w-8 h-8" />
      </button>
    </div>
  </div>
</header>

<!-- SIDEBAR -->
<aside
  id="sidebar"
  class="fixed top-0 right-0 z-[9999] w-full h-screen
         bg-white border-l border-gray-100 shadow-2xl
         translate-x-full transition-transform duration-500"
>
  <button id="closesidebar"
          class="absolute top-5 right-5 p-2 rounded-full bg-gray-100">
    <img src="/icons/X.svg" class="w-7 h-7" />
  </button>


<!-- MOBILE SEARCH (Headless) -->
<div class="mt-20 px-5">
  <input
    id="mobileProductSearch"
    type="search"
    placeholder="Search products…"
    class="w-full rounded-xl border border-gray-300 px-4 py-3 text-base"
  />

  <div
    id="mobileProductResults"
    class="mt-3 hidden rounded-xl bg-white border border-gray-100
           shadow-xl max-h-[50vh] overflow-y-auto"
  ></div>
</div>



  <div class="flex flex-col justify-start h-full px-8 py-10">
    <nav class="flex flex-col space-y-5 text-2xl font-medium">

      <a href="/" class="hover:text-red-600">Home</a>

      <!-- MOBILE PRODUCTS -->
      <div class="border-b border-gray-200 pb-2">
        <button id="mobileProductsBtn"
                class="flex items-center justify-between w-full text-black">
          Products
          <svg id="mobileProductsIcon"
               class="w-10 h-10 transition-transform bg-black rounded-full p-2 text-white"
               fill="none" stroke="currentColor" stroke-width="2"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

       <div
  id="mobileProductsMenu"
  class=" text-lg overflow-hidden
         max-h-0 opacity-0
         transition-all duration-300 ease-in-out text-white"
>
          <a href="/products/lighting">Lighting</a>
          <a href="/products/switch-socket">Switch & Socket</a>
          <a href="/products/wiring-accessories">Wiring Accessories</a>
          <a href="/products/gi-conduit-accessories">GI Conduit & Accessories</a>
          <a href="/products/connectors">Connectors</a>
          <a href="/products/cable-management">Cable Management</a>
          <a href="/products/tools">Tools</a>
        </div>
      </div>

      <a href="/About" class="hover:text-red-600">About</a>
      <a href="/Blog" class="hover:text-red-600">Blog</a>

      <a
  href="/ultra/UltraDark"
  class="flex items-center justify-between w-fit gap-5
         bg-[#0b0b0b]
         rounded-full p-3
         shadow-xl border border-white/10 mx-auto"
>
  <!-- LOGO -->
  <img
    src="/icons/ULTRA-23.png"
    alt="Ultra Series"
    class="h-12 object-contain"
  />

  <!-- CTA TEXT + ARROW -->
  <div class="flex items-center justify-between gap-4">
    <span class="text-lg font-semibold tracking-wide text-white uppercase">
      Explore
    </span>
    <span
      class="flex items-center justify-center
             w-14 h-14 rounded-full bg-white"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="w-6 h-6 text-black"
      >
        <path d="M5 12h14" />
        <path d="M13 5l6 7-6 7" />
      </svg>
    </span>
  </div>
</a>


    </nav>
  </div>
</aside>

<style>
.product-card {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: 0.75rem;
  border: 1px solid #f1f1f1;
  transition: all .25s ease;
}
.product-card:hover {
  border-color: #e60202;
}
.product-card span {
  font-size: 0.875rem;
  font-weight: 500;
}
.product-card:hover span {
  color: black;
}
.product-card .icon {
  width: 32px;
  height: 32px;
  object-fit: contain;
}

#mobileProductsMenu a {
  display: block;
  padding: 0.4rem 0;
  color:black;
  transition: color .2s ease;
}

/* ===============================
   PAGEFIND – DESKTOP NAVBAR
================================ */

.navbar-search .pagefind-ui__search-input {
  width: 16rem;
  padding: 0.55rem 1rem;
  border-radius: 9999px;
  border: 1px solid #e5e7eb;
  font-size: 0.875rem;
}

.navbar-search .pagefind-ui__results {
  position: absolute;
  right: 0;
  top: calc(100% + 0.75rem);
  width: 22rem;
  max-height: 60vh;
  overflow-y: auto;
  background: white;
  border-radius: 1rem;
  border: 1px solid #f1f1f1;
  box-shadow: 0 20px 40px rgba(0,0,0,0.12);
  z-index: 9999;
}

/* ===============================
   PAGEFIND – MOBILE SIDEBAR
================================ */

.mobile-search .pagefind-ui__search-input {
  width: 100%;
  padding: 0.75rem 1rem;
  border-radius: 0.75rem;
  border: 1px solid #e5e7eb;
  font-size: 1rem;
}

.mobile-search .pagefind-ui__results {
  margin-top: 0.75rem;
  max-height: 50vh;
  overflow-y: auto;
  border-radius: 0.75rem;
  border: 1px solid #f1f1f1;
}

</style>

<script>
import { gsap } from "gsap";

const header = document.getElementById("header");
let lastScroll = 0;
let isHidden = false;

gsap.set(header, { y: -120 });

window.addEventListener("load", () => {
  gsap.to(header, { y: 0, autoAlpha: 1, duration: .8 });
});

window.addEventListener("scroll", () => {
  const s = window.scrollY;
  if (s < 100) return gsap.to(header, { y: 0, autoAlpha: 1 });
  if (s > lastScroll && !isHidden) {
    gsap.to(header, { y: "-110%", autoAlpha: 0 });
    isHidden = true;
  } else if (s < lastScroll && isHidden) {
    gsap.to(header, { y: 0, autoAlpha: 1 });
    isHidden = false;
  }
  lastScroll = s;
});

const menuIcon = document.getElementById("menuIcon");
const sidebar = document.getElementById("sidebar");
const closeBtn = document.getElementById("closesidebar");

menuIcon.onclick = () => {
  sidebar.classList.replace("translate-x-full","translate-x-0");
  document.body.style.overflow = "hidden";
};

closeBtn.onclick = () => {
  sidebar.classList.replace("translate-x-0","translate-x-full");
  document.body.style.overflow = "";
};

const btn = document.getElementById("mobileProductsBtn");
const menu = document.getElementById("mobileProductsMenu");
const icon = document.getElementById("mobileProductsIcon");

let isOpen = false;

btn.onclick = () => {
  isOpen = !isOpen;

  if (isOpen) {
    menu.style.maxHeight = menu.scrollHeight + "px";
    menu.classList.remove("opacity-0");
    menu.classList.add("opacity-100");
    icon.classList.add("rotate-180");
  } else {
    menu.style.maxHeight = "0px";
    menu.classList.add("opacity-0");
    menu.classList.remove("opacity-100");
    icon.classList.remove("rotate-180");
  }
};

</script>

<script type="module" is:inline>
  let pagefind;

  async function getPagefind() {
    if (!pagefind) {
      pagefind = await import("/pagefind/pagefind.js");
      await pagefind.init();
    }
    return pagefind;
  }

  function setupSearch(inputId, resultsId) {
    const input = document.getElementById(inputId);
    const resultsBox = document.getElementById(resultsId);
    if (!input || !resultsBox) return;

    let searchTimeout;

    input.addEventListener("input", () => {
      const q = input.value.trim();

      // Clear any pending search
      if (searchTimeout) clearTimeout(searchTimeout);

      if (!q) {
        resultsBox.classList.add("hidden");
        resultsBox.innerHTML = "";
        return;
      }

      // Light debounce to avoid spamming the search API
      searchTimeout = setTimeout(async () => {
        const pf = await getPagefind();
        const search = await pf.search(q);
        if (!search) return;

        resultsBox.innerHTML = "";

        let shown = 0;

        for (const r of search.results) {
          if (shown >= 6) break;

          const data = await r.data();
          const url = data.url || "";
          const segments = url.split("/").filter(Boolean);

          // Only show product detail pages: /products/:category/:slug
          if (!(segments[0] === "products" && segments.length === 3)) {
            continue;
          }

          shown += 1;

          // Prefer the product image provided by Pagefind's meta,
          // fall back to a neutral placeholder if missing.
          const safeImage =
            typeof data.meta.image === "string" && data.meta.image
              ? data.meta.image
              : "/images/placeholder.png";

          resultsBox.innerHTML += `
  <a href="${url}"
     class="group flex items-center gap-4 px-4 py-3
            border-b border-gray-100 last:border-b-0
            hover:bg-gray-50 transition-colors">

    <!-- Product Image -->
    <img
      src="${safeImage}"
      class="w-12 h-12 object-contain rounded-lg
             bg-gray-100 flex-shrink-0"
      onerror="this.src='/images/placeholder.png'"
    />

    <!-- Product Info -->
    <div class="min-w-0 flex-1">
      <div class="text-sm font-medium text-gray-900 truncate">
        ${data.meta.name ?? data.meta.title ?? "Unknown product"}
      </div>
      <div class="text-xs text-gray-500 capitalize">
        ${data.meta.category ?? ""}
      </div>
    </div>

    <!-- Right Arrow CTA -->
    <span
      class="flex items-center justify-center
             w-9 h-9 rounded-full
             border border-gray-200
             text-gray-600
             transition-all
             group-hover:bg-red-500
             group-hover:border-red-500
             group-hover:text-white"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M5 12h14" />
        <path d="M13 5l7 7-7 7" />
      </svg>
    </span>

  </a>
`;
        }

        if (shown === 0) {
          resultsBox.classList.add("hidden");
          resultsBox.innerHTML = "";
        } else {
          resultsBox.classList.remove("hidden");
        }
      }, 150);
    });
  }

  setupSearch("productSearch", "productResults");
  setupSearch("mobileProductSearch", "mobileProductResults");
</script>

