---
import Layout from "@/layouts/Layout.astro";
import { sanity } from "@/sanity/lib/sanity";
import { PortableText } from "astro-portabletext";

export const prerender = false;

const { slug } = Astro.params;

const post = await sanity.fetch(
  `
  *[_type == "blogPost" && slug.current == $slug][0]{
    title,
    excerpt,
    content,        // ✅ FIXED
    author,
    publishedAt,
    coverImage{
      asset->{url}
    }
  }
  `,
  { slug }
);

if (!post) {
  throw new Error("Blog post not found");
}
---
<Layout>
  <article class="bg-white py-16 sm:py-20">
    <div class="container mx-auto px-6 max-w-4xl">

      <h1 class="text-3xl sm:text-4xl font-semibold text-gray-900">
        {post.title}
      </h1>

      <div class="flex gap-4 text-sm text-gray-500 mt-3">
        <span>{post.author}</span>
        <span>•</span>
        <span>
          {new Date(post.publishedAt).toLocaleDateString("en-IN", {
            day: "2-digit",
            month: "short",
            year: "numeric",
          })}
        </span>
      </div>

      {post.coverImage?.asset?.url && (
        <img
          src={post.coverImage.asset.url}
          alt={post.title}
          class="w-full rounded-3xl mt-10 mb-10 object-cover"
        />
      )}

      <!-- ✅ THIS NOW WORKS -->
      <div class="prose prose-lg max-w-none prose-gray">
        <PortableText value={post.content} />
      </div>

    </div>
  </article>
</Layout>
